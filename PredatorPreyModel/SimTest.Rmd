---
title: "SimTest"
author: "Justin Mann"
date: "2023-10-04"
output: html_document
runtime: shiny
---

```{r sim, echo=FALSE}
library(shiny)

ui <- fluidPage(
  numericInput("camiPop", "Enter starting Caminalcule population (1-100):", min = 1, max = 100, value = 1),
  numericInput("pollPop", "Enter starting Pollard population (1-75):", min = 1, max = 75, value = 1),
  numericInput("camiPopMultiply", "Enter Caminalcule Reproduction rate (1-10):", min = 1, max = 10, value = 1),
  numericInput("numGenerations", "Enter the number of generations to simulate (1-100):", min = 1, max = 100, value = 1),
  radioButtons("printArray", "Display a population array after each generation:", choices = c("Yes" = TRUE, "No" = FALSE), inline = TRUE),
  actionButton("simulateButton", "Simulate"),
  verbatimTextOutput("simulationOutput")
)

server <- function(input, output, session) {
  # Define reactive values to store camiPop and pollPop
  camiPop <- reactiveVal()
  pollPop <- reactiveVal()
  
  observeEvent(input$simulateButton, {
    # Get user inputs
    camiPop(input$camiPop)
    pollPop(input$pollPop)
    camiPopMultiply <- input$camiPopMultiply
    numGenerations <- input$numGenerations
    printArray <- input$printArray
    
    # Run simulation
    simulationOutput <- beginSim(camiPop(), pollPop(), camiPopMultiply, numGenerations, printArray)
    
    # Display simulation results
    output$simulationOutput <- renderPrint({
      simulationOutput
    })
  })
  
  # Simulation function remains unchanged
beginSim <- function(camiPop, pollPop, camiPopMultiply, numGenerations, printArray) {
    for (index in 1:numGenerations) {
    found <- 0
    biome <- matrix(FALSE, nrow = 10, ncol = 10)
    
    for (cami in 1:camiPop) {
      x <- sample(1:10, 1)
      y <- sample(1:10, 1)
      
      if (!biome[x, y]) {
        biome[x, y] <- TRUE
      } else {
        while (biome[x, y]) {
          x <- sample(1:10, 1)
          y <- sample(1:10, 1)
        }
        biome[x, y] <- TRUE
      }
    }
    
    chosenXY <- matrix(FALSE, nrow = 10, ncol = 10)
    
    for (polly in 1:pollPop) {
      x <- sample(1:10, 1)
      y <- sample(1:10, 1)
      
      while (chosenXY[x, y]) {
        x <- sample(1:10, 1)
        y <- sample(1:10, 1)
      }
      
      if (biome[x, y] && !chosenXY[x, y]) {
        camiPop <- camiPop - 1
        found <- found + 1
        chosenXY[x, y] <- TRUE
      } else {
        chosenXY[x, y] <- TRUE
      }
    }
    
    camiPop <- camiPop * camiPopMultiply
    if (camiPop < 1) camiPop <- 1
    if (camiPop > 100) camiPop <- 100
    
    lostPop <- floor(pollPop / 3)
    pollPop <- pollPop - lostPop
    pollPop <- pollPop + found + 1
    
    if (pollPop > 75) pollPop <- 75
    if (pollPop < 1) pollPop <- 1
    
  }
}
    # Return the simulation results in an appropriate format
    return(simulationOutput)
  }


shinyApp(ui, server)
```

