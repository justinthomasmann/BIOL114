---
title: "Untitled"
author: "Justin Mann"
date: "`r Sys.Date()`"
output: html_document
runtime: shiny
---


## Predator-Prey Population Modeling 

```{r setup, echo=FALSE}
library(shiny)
library(DT)

printBiome <- function(biome, chosenXY) {
  data <- data.frame(row = character(0), col = character(0), value = character(0))
  for (i in 1:10) {
    for (j in 1:10) {
      if (biome[i, j] && !chosenXY[i, j]) {
        data <- rbind(data, data.frame(row = i, col = j, value = "1"))
      } else if (biome[i, j] && chosenXY[i, j]) {
        data <- rbind(data, data.frame(row = i, col = j, value = "X"))
      } else {
        data <- rbind(data, data.frame(row = i, col = j, value = "0"))
      }
    }
  }
  return(data)
}

printCoordinates <- function(biome, chosenXY) {
  data <- data.frame(species = character(0), row = numeric(0), col = numeric(0))
  for (i in 1:10) {
    for (j in 1:10) {
      if (biome[i, j]) {
        data <- rbind(data, data.frame(species = "Caminalcule", row = i, col = j))
      }
      if (chosenXY[i, j]) {
        data <- rbind(data, data.frame(species = "Pollard", row = i, col = j))
      }
    }
  }
  return(data)
}


ui <- fluidPage(
  titlePanel("Caminalcule and Pollard Simulation"),
  sidebarLayout(
    sidebarPanel(
      numericInput("camiPop", "Initial Caminalcule Population:", 1, 1, 100),
      numericInput("pollPop", "Initial Pollard Population:", 1, 1, 75),
      numericInput("camiPopMultiply", "Caminalcule Population Multiplier:", 1, 1, 10),
      numericInput("numGenerations", "Number of Generations:", 1, 1, 100),
      checkboxInput("printArray", "Print Location Array", FALSE),
      checkboxInput("printLocations", "Print Location Coordinates", FALSE),
      actionButton("simulateBtn", "Simulate"),
      DTOutput("simulationOutput")
    ),
    mainPanel()
  )
)

server <- function(input, output, session) {
  observeEvent(input$simulateBtn, {
    camiPop <- input$camiPop
    pollPop <- input$pollPop
    camiPopMultiply <- input$camiPopMultiply
    numGenerations <- input$numGenerations
    printArray <- input$printArray
    printLocations <- input$printLocations

    results <- character(0)

    results <- c(results, sprintf("Gen: 0 Starting Caminalcule Pop: %d Starting Pollard Pop: %d\n", camiPop, pollPop))

    biome <- matrix(FALSE, nrow = 10, ncol = 10)
    chosenXY <- matrix(FALSE, nrow = 10, ncol = 10)

    for (index in 1:numGenerations) {
      found <- 0

      for (cami in 1:camiPop) {
        x <- sample(1:10, 1)
        y <- sample(1:10, 1)

        if (!biome[x, y]) {
          biome[x, y] <- TRUE
        } else {
          while (biome[x, y]) {
            x <- sample(1:10, 1)
            y <- sample(1:10, 1)
          }
          biome[x, y] <- TRUE
        }
      }

      for (polly in 1:pollPop) {
        x <- sample(1:10, 1)
        y <- sample(1:10, 1)

        while (chosenXY[x, y]) {
          x <- sample(1:10, 1)
          y <- sample(1:10, 1)
        }

        if (biome[x, y] && !chosenXY[x, y]) {
          camiPop <- camiPop - 1
          found <- found + 1
          chosenXY[x, y] <- TRUE
        } else {
          chosenXY[x, y] <- TRUE
        }
      }

      camiPop <- camiPop * camiPopMultiply
      if (camiPop < 1) camiPop <- 1
      if (camiPop > 100) camiPop <- 100

      lostPop <- floor(pollPop / 3)
      pollPop <- pollPop - lostPop
      pollPop <- pollPop + found + 1

      if (pollPop > 75) pollPop <- 75
      if (pollPop < 1) pollPop <- 1

      results <- c(results, sprintf("Gen: %d Ending Caminalcule Pop: %d Ending Pollard Pop: %d || found: %d\n", index, camiPop, pollPop, found))
      if (printArray) results <- c(results, printBiome(biome, chosenXY))
      if (printLocations) results <- c(results, printCoordinates(biome, chosenXY))
    }

    # Create a data frame with simulation results
    simulationResults <- data.frame(Generation = 1:numGenerations, Results = results)

    if (printArray) {
      # Print biome and chosenXY matrices if printArray is TRUE
      output$simulationOutput <- renderDT({
        DT::datatable(printBiome(biome, chosenXY), options = list(pageLength = 10))
      })
    } else if (printLocations) {
      # Print location coordinates if printLocations is TRUE
      output$simulationOutput <- renderDT({
        DT::datatable(printCoordinates(biome, chosenXY), options = list(pageLength = 10))
      })
    } else {
      # Display simulation results as a data table using DT package
      output$simulationOutput <- renderDT({
        DT::datatable(simulationResults, options = list(pageLength = 10))
      })
    }
  })
}

shinyApp(ui, server)
```




